# Copyright (C) 2020 Casper Meijn <casper@meijn.net>
#
# SPDX-License-Identifier: CC0-1.0

name: Optimize images

on:
  push:
    branches:
      - main
      - master

jobs:
  optimize-images:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Install image tools
      run: |
        sudo apt-get -y install jpegoptim imagemagick

    - name: Run imagemagick to reduce size
      run: |
        find -name *.jpg -exec mogrify -verbose -resize 1000000\@\> {} \;

    - name: Run jpegoptim to optimize
      run: |
        find -name *.jpg -exec jpegoptim --strip-all --max=85 {} \;

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v3
      with:
        commit-message: Optimize images
        title: Optimize images
        body: Run jpegoptim to optimize the images
        branch: optimize-images
        delete-branch: true
